<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Bustrinker</title>
    <link rel="icon" href="icon.jpeg" type="image/jpeg">
    <link rel="sitemap" type="application/xml" title="Sitemap" href="sitemap.xml">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    
    <!-- Link zur externen CSS-Datei -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
    <!-- Screen 1: Home -->
    <div id="home-screen" class="screen active">
        <h1>BusTrinker</h1>
        <input type="text" id="nickname-input" placeholder="Dein Nickname">
        <button onclick="hostGame()">Spiel hosten</button>
        <hr>
        <input type="text" id="room-code-input" placeholder="Raum-Code" style="text-transform:uppercase">
        <button class="secondary-button" onclick="joinGame()">Spiel beitreten</button>
        <hr>
        <input type="text" id="display-code-input" placeholder="Display-Code">
        <button class="warning-button" onclick="joinAsDisplay()">Als Display beitreten</button>
        <button class="warning-button" style="margin-top: 20px;" onclick="window.open('rules.html', '_blank');">Regeln & Anleitung</button>
    </div>

    <!-- Screen 2: Lobby -->
    <div id="lobby-screen" class="screen">
        <h2>Lobby</h2>
        <p>Raum-Code:</p><div class="room-code" id="room-code-display"></div>
        <p><strong id="player-count">0</strong>/10 Spieler:</p><ul id="player-list"></ul>
        <div id="host-controls" style="display:none">
            <div class="settings-form">
                <label>Kartenanzahl:
                    <select id="card-count-select" onchange="updateSettings()">
                        <option value="32">32</option>
                        <option value="52">52</option>
                    </select>
                </label>
                <label>Anzahl Reihen:
                    <select id="row-count-select" onchange="updateSettings()">
                        <option value="3">3</option><option value="4">4</option>
                        <option value="5">5</option><option value="6">6</option>
                        <option value="7">7</option><option value="8">8</option>
                    </select>
                </label>
                <label class="checkbox-label"><input type="checkbox" id="external-display-checkbox" onchange="updateSettings()"> Externes Display?</label>
            </div>
            <div id="display-code-area" style="display:none">
                <p>Display-Code:</p><div class="display-code" id="display-code-display"></div>
            </div>
            <button id="start-game-button" onclick="startGame()" disabled>Spiel starten</button>
        </div>
        <div id="player-wait-message" style="display:none">
            <p>Warte, bis der Host startet...</p>
            <div id="player-settings-display"></div>
        </div>
    </div>

    <!-- Screen 3: Game (für Spieler) -->
    <div id="game-screen" class="screen">
        <h1>Spiel läuft!</h1>
        <div id="host-game-controls" style="display:none">
            <button id="reveal-pyramid-card-button" onclick="revealNextPyramidCardByHost()">Pyramiden-Karte aufdecken</button>
            <button id="reveal-discard-card-button" onclick="revealNextDiscardCard()">Reststapel-Karte aufdecken</button>
            <div class="muted" id="host-wait-hint" style="display:none">Warten auf Abgaben/Bestätigungen…</div>
        </div>
        <div id="public-info" class="game-section">
            <h3>Pyramide</h3><div id="pyramid-area-player"></div>
            <h3>Aufgedeckte Restkarten</h3><div id="public-revealed-cards">Keine</div>
            <p class="muted">Aktiver Wert:<span id="active-trigger-player" class="trigger-badge">–</span></p>
        </div>
        <div id="my-hand" class="game-section">
            <h3>Deine Handkarten</h3><div id="hand-cards-display"></div>
        </div>
        <div id="received-cards" class="game-section" style="display:none">
            <h3>Erhaltene Karten</h3><div id="received-cards-display"></div>
        </div>
        <div id="give-card-controls" style="display:none">
            <p><strong>Aktion!</strong> Weise jede deiner Karten mit dem aktiven Wert einem Spieler zu.</p>
            <div id="card-assignment-area"></div>
            <button onclick="giveCard()">Ausgewählte Karten abgeben</button>
            <div class="muted">Weiter geht’s erst, wenn alle Pflicht-Geber abgegeben haben und alle Empfänger bestätigt haben.</div>
        </div>
        <hr>
        <p>Spieler (Score):</p><ul id="game-player-list"></ul>
    </div>

    <!-- Screen 4: Display (für externes Gerät) -->
    <div id="display-screen" class="screen">
        <h1>Externes Display</h1>
        <div id="display-content" class="game-section">
            <h3>Pyramide</h3><div id="pyramid-area-display"></div>
            <hr><h3>Aufgedeckte Restkarten</h3><div id="display-revealed-cards"></div>
            <p class="muted">Aktiver Wert:<span id="active-trigger-display" class="trigger-badge">–</span></p>
        </div>
    </div>
</div>

<!-- Overlay für Kartenbestätigung -->
<div id="card-received-overlay" class="overlay" style="display:none">
    <div class="overlay-content">
        <h2>Karten erhalten!</h2>
        <p>Du hast <strong id="received-card-value"></strong> erhalten.</p>
        <button onclick="confirmReceivedCard()">Bestätigen</button>
    </div>
</div>

<!-- Firebase und Konfiguration -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="config.js"></script>

<!-- Link zur externen JavaScript-Datei -->
<script src="script.js"></script>
</body>
</html>
